<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter.Today: 감정분석 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<header id="navigation-bar">

    <div class="logo">🎨 Filter.Today</div>

    <div class="month-selector">
        <label for="year-select">날짜:</label>
        <select id="year-select"></select>
        <select id="month-select"></select>
    </div>

    <div class="auth-buttons">

        <span sec:authorize="isAuthenticated()" style="font-weight: bold; color: #333; margin-left: 10px;">
             <span sec:authentication="name">User</span>님
        </span>

        <button id="login-btn"
                onclick="location.href='/login'"
                sec:authorize="isAnonymous()">
            로그인
        </button>

        <button id="logout-btn"
                onclick="location.href='/logout'"
                sec:authorize="isAuthenticated()">
            로그아웃
        </button>
    </div>
</header>

<main class="dashboard-container">
    <section id="hue-map-section">
        <h2>🌈 Tone & Mood </h2>

        <div class="emotion-legend">
            <div class="legend-item"><span class="color-dot" style="background: #FFD700;"></span>즐거움</div>
            <div class="legend-item"><span class="color-dot" style="background: #FFA500;"></span>설렘</div>
            <div class="legend-item"><span class="color-dot" style="background: #32CD32;"></span>뿌듯함</div>
            <div class="legend-item"><span class="color-dot" style="background: #ADD8E6;"></span>차분함</div>
            <div class="legend-item"><span class="color-dot" style="background: #9370DB;"></span>스트레스</div>
            <div class="legend-item"><span class="color-dot" style="background: #FF4500;"></span>분노</div>
            <div class="legend-item"><span class="color-dot" style="background: #4682B4;"></span>슬픔</div>
            <div class="legend-item"><span class="color-dot" style="background: #A9A9A9;"></span>피곤함</div>
        </div>
        <div id="calendar-grid">
            <div class="day-header">월</div>
            <div class="day-header">화</div>
            <div class="day-header">수</div>
            <div class="day-header">목</div>
            <div class="day-header">금</div>
            <div class="day-header">토</div>
            <div class="day-header">일</div>
        </div>
    </section>

    <aside class="sidebar">
        <section id="stats-section">
            <h3>📊 STATISTICS</h3>
            <div class="chart-container">
                <canvas id="emotion-pie-chart"></canvas>
            </div>
        </section>

        <section id="diary-input-section">
            <h3>📝 DIARY </h3>

            <div id="date-display-area" style="margin: 20px 0 5px 0; font-weight: bold; color: #555;">
                📅 날짜를 선택해주세요
            </div>
            <input type="hidden" id="selected-date-hidden">

            <div class="input-mode-tabs" style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button id="mode-manual-btn" class="mode-btn active" onclick="setEntryMode('manual')">🎨 직접 선택</button>
                <button id="mode-ai-btn" class="mode-btn" onclick="setEntryMode('ai')">🤖 AI 분석</button>
            </div>

            <div id="color-picker-placeholder" style="margin-top: 10px;">
                <div id="manual-input-area">
                    <input type="color" id="emotion-color-picker" value="#ff9900">
                    <span id="selected-emotion-label"> (새 기록)</span>
                </div>

                <textarea id="diary-text-input"
                          placeholder="달력에서 날짜를 먼저 선택해야 작성할 수 있습니다."
                          rows="4" disabled></textarea>

                <button id="save-diary-btn">저장</button>
                <button id="delete-diary-btn" style="display:none;">삭제</button>
            </div>
        </section>

        <div id="ai-result-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h3>🤖 AI 분석 결과</h3>
                <p>작성하신 일기를 분석해보니...</p>

                <div id="ai-result-display" style="margin: 20px 0; text-align: center;">
                    <div id="ai-color-circle" style="width: 50px; height: 50px; border-radius: 50%; margin: 0 auto;"></div>
                    <h4 id="ai-emotion-text" style="margin-top: 10px;">기쁨</h4>
                </div>

                <p>이 감정으로 저장하시겠습니까?</p>
                <div class="modal-buttons">
                    <button id="ai-confirm-btn" style="background-color: #4CAF50; color: white;">네, 저장할게요</button>
                    <button onclick="closeAiModal()" style="background-color: #f44336; color: white;">아니요</button>
                </div>
            </div>
        </div>
    </aside>
</main>

<script th:src="@{/js/auth/auth.js}" defer></script>
<script th:src="@{/js/chart.js}" defer></script>
<script th:src="@{/js/diary.js}" defer></script>
<script th:src="@{/js/dashboard.js}" defer></script>
</body>
</html>